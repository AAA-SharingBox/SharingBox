{% extends "base.html" %}
{% load django_bootstrap5 %}

{% block extraheader %}
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
{% endblock %}

{% block main %}
    {% include 'slogan.html' %}

    <ul class="nav nav-tabs">
        <li class="nav-item">
            <a href="{% url 'top' %}" class="nav-link">投稿日順</a>
        </li>
        <li class="nav-item">
            <a href="#" class="nav-link active">いいね数順</a>
        </li>
    </ul>
    {% for data in context %}
        <div class="card my-2 shadow">
            <div class="card-body">
                <div class="h5 card-title">{{ data.post.url }}</div>
                <div class="h6 card-subtitle">
                    投稿者：
                    {{ data.post.created_by }}
                    {% if data.post.created_by.is_superuser %}
                        <span style="color:red"><b>(管理人)</b></span>
                    {% endif %}
                </div>
                <div class="h6 card-subtitle">
                    投稿日：
                    {{ data.post.created_at }}
                </div>
                <p class="card-text">{{ data.post.description }}</p>
                <p class="card-text">検索ワード：「{{ data.post.search_word }}」</p>
                <a href="{{ data.post.url }}" target="_blank" class="btn btn-primary">このサイトを見る</a>
                {% if request.user.is_authenticated %}
                    {% if data.good %}
                        <a class="btn btn-danger" id="goodBtn-{{ data.post.id }}" onClick="good_change('{% url "good:good_change" data.post.id %}' , 'goodBtn-{{data.post.id}}' )">
                            <span class="material-symbols-outlined">favorite</span>
                        </a>
                    {% else %}
                        <a class="btn btn-outline-danger" id="goodBtn-{{ data.post.pk }}" onClick="good_change('{% url "good:good_change"  data.post.pk %}' , 'goodBtn-{{data.post.id}}' )">
                            <span class="material-symbols-outlined">favorite</span>
                        </a>
                    {% endif %}
                    <span>{{ data.good_count }}</span>
                {% endif %}
            </div>
        </div>
    {% endfor %}

    

    <script>
        function good_change( url, btnId )
        {
            btn = document.querySelector('#'+btnId);
            let option = {
                cache: 'no-cache',
                Credential: 'sameorigin'
            };

            fetch(url, option).then( value => {
                if( btn.className == "btn btn-danger")
                {
                    btn.className = "btn btn-outline-danger";
                }
                else
                {
                    btn.className = "btn btn-danger";
                }
            })
        }
    </script>
{% endblock %}